\chapter{Preparing the Environment}
\label{ch:preparing-the-environment}

Before you can really start using the \hpc clusters, there are several things you need to do or know:

\begin{enumerate}
\item  You need to \textbf{log on to the cluster} using an ssh-client to one of the login nodes. This will give you command-line access. The software you'll need to use on your client system depends on its operating system.
\item  Before you can do some work, you'll have to \textbf{transfer the files} that you need from your desktop computer to the cluster. At the end of a job, you might want to transfer some files back.
\item  Optionally, if you wish to use programs with a \textbf{graphical user interface}, you will need an X-server on your client system.
\item  Often several versions of \textbf{software packages and libraries} are installed, so you need to select the ones you need. To manage different versions efficiently, the VSC clusters use so-called \textbf{modules}, so you will need to select and load the modules that you need.
\end{enumerate}

\section{First Time connection to the \hpc}
\label{sec:first-time-connection-to-the-hpc}

\ifwindows

  \subsection{Open a Terminal}
  \label{sec:windows-open-a-terminal}

  You've generated a public/private key pair with PuTTYgen and have an approved
  account on the VSC clusters.  The next step is to setup the connection to (one
  of) the \hpc.

  In the screenshots, we show the setup for user ``\strong{\emph{vsc20167}}''
  to the \hpc cluster via the loginnode
  ``\strong{\emph{\loginnode}}''.

  \begin{enumerate}
    \item  Start the PuTTY executable $<$\strong{\emph{putty.exe}}$>$ in your
      directory ``\strong{\emph{C:\textbackslash Program Files (x86)\textbackslash PuTTY}}'' and the
      configuration screen will pop up. As you will often use the PuTTY tool,
      we recommend adding a shortcut on your desktop.
    \item  Within the category $<$\strong{\emph{Session}}$>$, in the field
      $<$\strong{\emph{Host Name}}$>$, enter the name of the loginnode of the
      \hpc cluster (i.e., ``\strong{\emph{\loginnode}}'')
      you want to connect to.

    \includegraphics*[width=3.59in, height=3.45in, keepaspectratio=false]{ch2-putty-configuration}

    \item  In the category \menu[,]{Connection,Data}, in
      the field \keys{Auto-login username}, put in
      $<$\emph{\userid}$>$, which is your VSC username that you have
      received by mail after your request was approved.

  \includegraphics*[width=3.11in, height=2.99in, keepaspectratio=false]{ch2-putty-configuration2}

    \item  In the category \menu[,]{Connection,SSH,Auth}, in the
      field \keys{Private key file for authentication} click on
      \keys{Browse} and select the private key (i.e., ``id\_rsa.ppk'')
      that you generated and saved above.

  \includegraphics*[width=3.25in, height=3.13in, keepaspectratio=false]{ch2-putty-key-setup}

    \item  In the category \menu[,]{Connection,SSH,X11}, click
      the \keys{Enable X11 Forwarding} checkbox.

  \includegraphics*[width=3.54in, height=3.41in, keepaspectratio=false]{ch2-putty-x-forwarding}

    \item  Now go back to $<$Session$>$, and fill in ``\emph{\hpcname}'' in the
      \keys{Saved Sessions} field and press \keys{Save} to
      store the session information.

  \includegraphics*[width=3.30in, height=3.17in, keepaspectratio=false]{ch2-putty-saved-session}

    \item  Now pressing \keys{Open}, will open a terminal window and
      asks for you passphrase.

  \includegraphics*[width=3.94in, height=2.47in, keepaspectratio=false]{ch2-putty-enter-password}

    \item  The first time you make a connection to the loginnode, a Security
      Alert will appear and you will be asked to verify the authenticity of the
      loginnode.
      \ifgent
      Make sure the fingerprint in the Alert matches \strong{\loginfingerprint}
      \fi

  \includegraphics*[width=3.91in, height=2.42in, keepaspectratio=false]{ch2-putty-verify-authenticity}

    \item  After entering your correct passphrase, you will be connected to the
      login-node of the \hpc.
    \item  To check you can now ``Print the Working Directory'' (pwd) and check
      the name of the computer, where you have logged in (hostname):

  \begin{prompt}
  %\shellcmd{pwd}%
  %\homedir%
  %\shellcmd{hostname --f}%
  %\loginhost%
  \end{prompt}

    \item  For future PuTTY sessions, just select your saved session (i.e.
      ``\emph{\hpcname}'') from the list, \keys{Load} it and press
      \keys{Open}.
  \end{enumerate}

%ENDIF windos
\fi

\ifmacORlinux
\subsection{Connect}
\label{sec:connect}

The \hpc is only accessible from within the \university network, but you can
get external access (e.g., from home) by using a VPN connection.

Open up a terminal and enter the following command to connect to the \hpc.
\ifmac
You can open a terminal by navigationg to Applications and then Utilities in the finder and open Terminal.app, or enter Terminal in Spotlight Search.
\fi

\begin{prompt}
%\shellcmd{ssh $<$%\userid%$>$@\loginnode}%
\end{prompt}

The first time you make a connection to the login node, you will be asked to
verify the authenticity of the login node, e.g.,

\begin{prompt}
%\shellcmd{ssh \userid{}@\loginnode{}}%
The authenticity of host %\loginnode% (<IP-adress>) can't be established.
RSA key fingerprint is %\loginfingerprint%
Are you sure you want to continue connecting (yes/no)? %\strong{\emph{yes}}%
\end{prompt}

Here, user \userid wants to make a connection to the ``\hpcname'' cluster at
\university via the login node ``\loginnode''.

\fi
\strong{Congratulations, you're on the \hpc infrastructure now!}
To find out where you have landed you can print the current working directory:
\begin{prompt}
%\shellcmd{pwd}%
%\homedir%
\end{prompt}


Your new private home-directory is ``\homedir''.
Here you can create your own sub-directory structure, copy and prepare your
applications, compile and test them and submit your jobs on the \hpc.

\begin{prompt}
%\shellcmd{cd \tutorialdir}%
%\shellcmd{ls }%
intro-HPC/
perfexpert
\end{prompt}

This directory currently contains all training material for the use of:

\begin{enumerate}
\item  The \strong{\emph{Introduction to the \hpc}}.
%\item  The \strong{\emph{Introduction to Linux}}.
%\item  The \strong{\emph{Python}} programming language.
%\item  The \strong{\emph{VI}} editor.
\item  Introduction to using \strong{\emph{perfexpert}}.
\end{enumerate}

More relevant training material to work with the \hpc can always be added
later in this directory.

You can now explore the content of this directory with the ``ls --l''
(\strong{l}ist\strong{s} \strong{l}ong) and the ``cd'' (\strong{c}hange
\strong{d}irectory) commands:

As we are interested in the use of the \strong{\emph{HPC}}, move further to
\strong{\emph{intro-HPC}} and explore the contents up to 2 levels deep:

\begin{prompt}
%\shellcmd{cd intro-HPC}%
%\shellcmd{tree -L 2}%
.
`-- examples
    %\textbar%-- Compiling-and-testing-your-software-on-the-HPC
    %\textbar%-- Fine-tuning-Job-Specifications
    %\textbar%-- Multi-core-jobs-Parallel-Computing
    %\textbar%-- Multi-job-submission
    %\textbar%-- Program-examples
    %\textbar%-- Running-batch-jobs
    %\textbar%-- Running-jobs-with-input
    %\textbar%-- Running-jobs-with-input-output-data
    %\textbar%-- example.pbs
    `-- example.sh
9 directories, 5 files
\end{prompt}

This directory contains:

\begin{enumerate}
  \item This \strong{\emph{HPC Tutorial}} (in either a Mac, Linux or Windows version).
  %TODO: these are not here yet? \item The according \strong{\emph{HPC slides}} (used during training sessions).
  %TODO: this is noth here yet? \item A \strong{\emph{docs}} sub-directory, containing interesting \hpc related documents.
  \item An \strong{\emph{examples}} sub-directory, containing all the
    examples that you need in this Tutorial, as well as examples that might be
    useful for your specific applications.
\end{enumerate}

\begin{prompt}
%\shellcmd{cd examples}%
\end{prompt}

\begin{tip}
Typing ``\strong{\emph{cd ex$<$TAB$>$}}'' will generate the
``\strong{\emph{cd examples}}'' command. \strong{Command-line completion
}(also tab completion) is a common feature of the bash command line
interpreter, in which the program automatically fills in partially typed
commands.
\end{tip}

\begin{tip}
For more exhaustive tutorials about Linux usage, see \ref{ch:useful-linux-commands}
\end{tip}

The first action is to copy the contents of the \hpc examples directory
to your home directory, so that you have your own personal copy and that
you can start using the examples. The ``-r'' option of the copy command
will also copy the contents of the sub-directories ``\emph{recursively}''.

\begin{prompt}
%\shellcmd{cp --r \examplesdir \tilde/}%
\end{prompt}

Go to your home directory, check your own private examples directory, \dots\
and start working.

%\shellcmd{cd}%
%\shellcmd{ls -l}%

\ifgent
Upon connecting you will see a login message containing your last login
timestamp and a basic overview of the current cluster utilisation.
\begin{prompt}
Last login: Tue Jan  6 08:53:11 2015 from helios.ugent.be

STEVIN HPC-UGent infrastructure status on Thu, 15 Jan 2015 15:20:01

   cluster - full - free -  part - total - running - queued
             nodes  nodes   free   nodes    jobs      jobs
-------------------------------------------------------------------
   haunter    151      0      0     151      N/A       N/A
    raichu     10      0     53      64      N/A       N/A
   dugtrio      0      3      0       5      N/A       N/A
  delcatty    123      9     26     158      N/A       N/A
    gastly     33      6      4      46      N/A       N/A
    gulpin     30      0      1      32      N/A       N/A
       muk    455      5     20     528      N/A       N/A

For a full view of the current loads and queues see:
 http://hpc.ugent.be/clusterstate/

\end{prompt}
\fi
\ifbrussel
Upon connectiong you will see a login message containing your last login
timestamp, some useful environment variable definitions and the message of the
day (MOTD).
\begin{prompt}
Last login: Thu Nov  6 16:05:21 2014 from example.vub.ac.be

Initialising your working environment...
System variables to use in your scripts/programs:
  Temporary directory:   \$TMPDIR as /tmp/vsc40485
  Temporary work directory:    \$WORKDIR as /work/vsc40485
  Home directory:              \$HOME as /user/home/gent/vsc404/vsc40485
Message of the day:

  --------------------------------------------------------------------
  Welcome to the Hydra cluster.

  The old work directory access has been closed.


  The Hydra Team
  --------------------------------------------------------------------
       \   ,__,
        \  (oo)____
           (__)    )\
              ||--||

\end{prompt}
\fi

\ifleuven
Upon connectiong you will see a login message containing your last login
timestamp and some useful links.
\begin{prompt}
Last login: Mon Jan 12 18:52:20 2015 from example.kuleuven.be
**********************************************
*                                            *
* Please check the following site for        *
* status messages concerning KU Leuven       *
* services (incl. HPC):                      *
*                                            *
*   http://status.kuleuven.be/               *
*                                            *
* For VSC user documentation:                *
*                                            *
* https://vscentrum.be/neutral/documentation *
*                                            *
*                                            *
**********************************************
\end{prompt}
\fi

\ifantwerpen
Upon connection, you will get a welcome message and your current disk and file
quotas are shown.

\begin{prompt}
%\dots%
Your quota is:
Block Limits
   Filesystem         KB      quota      limit    grace
   data            82944   26214400   28835840     none
   home            35328    3145728    3461120     none
   scratch         47808   26214400   28835840     none

File Limits
   Filesystem      files      quota      limit    grace
   data               27     100000     150000     none
   home              125      20000      25000     none
   scratch            11     100000     150000     none
----------------------------------------------------------
\end{prompt}
\fi

You can exit the connection at anytime by entering:

\begin{prompt}
%\shellcmd{exit}%
logout
Connection to %\loginnode% closed.
\end{prompt}

\begin{tip}[Setting your Language right]

You may encounter the following warning message during connecting:
\begin{prompt}
perl: warning: Setting locale failed.
perl: warning: Please check that your locale settings:
LANGUAGE = (unset),
LC_ALL = (unset),
LC_CTYPE = "UTF-8",
LANG = (unset)
    are supported and installed on your system.
perl: warning: Falling back to the standard locale ("C").
\end{prompt}

This means that the correct ``locale'' has not yet been properly specified on
your local machine. Try:

\begin{prompt}
%\shellcmd{locale}%
LANG=
LC_COLLATE="C"
LC_CTYPE="UTF-8"
LC_MESSAGES="C"
LC_MONETARY="C"
LC_NUMERIC="C"
LC_TIME="C"
LC_ALL=
\end{prompt}
\end{tip}

A \strong{locale} is a set of parameters that defines the user's language,
country and any special variant preferences that the user wants to see in their
user interface. Usually a locale identifier consists of at least a language
identifier and a region identifier.

Open the .bash\_profile or the .profile on your local machine with your
favorite editor and add the following lines:

\begin{prompt}
%\shellcmd{vi ~/.bash\_profile}%
%\dots%
export LANGUAGE="en_US.UTF-8"
export LC_ALL="en_US.UTF-8"
export LC_CTYPE="en_US.UTF-8"
export LANG="en_US.UTF-8"
%\dots%
\end{prompt}

\begin{tip}[vi]
To start entering text in vi: move to the place you want to start entering text
with the arrow keys and type ``i'' to switch to insert mode.  You can easily
exit vi by entering: ``<esc>:wq''
To exit vi without saving your changes, enter ``<esc>:q!''
\end{tip}

or alternatively (if you are not comfortable with the Linux editors):

\begin{prompt}
%\shellcmd{echo "export LANGUAGE=\textbackslash "en\_US.UTF-8\textbackslash " $>$$>$ ~/.profile"}%
%\shellcmd{echo "export LC\_ALL=\textbackslash "en\_US.UTF-8\textbackslash " $>$$>$ ~/.profile"}%
%\shellcmd{echo "export LC\_CTYPE=\textbackslash "en\_US.UTF-8\textbackslash " $>$$>$ ~/.profile"}%
%\shellcmd{echo "export LANG="en\_US.UTF-8\textbackslash " $>$$>$ ~/.profile"}%
\end{prompt}

You can now log-out and re-connect to the \hpc, and you should not get these
warnings anymore.

\section{Transfer Files to/from the \hpc}

Before you can do some work, you'll have to \strong{transfer the files}
you need from your desktop or department to the cluster. At the end of a job,
you might want to transfer some files back.

\ifmacORlinux
The preferred way to transfer files is by using an scp or sftp via the secure
OpenSSH protocol.  Linux and OS X are shipped with an implementation of
OpenSSH, so you don't need to install any third-party software to use it. Just
open a terminal window and jump in!
\fi

\ifwindows
  \subsection{WinSCP}

  To transfer files to and from the cluster, we recommend the use of WinSCP,
  which is a graphical ftp-style program (but than one that uses the ssh way of
  communicating with the cluster rather then the less secure ftp) that is also
  freely available. WinSCP can be downloaded both as an installation package
  and as a standalone portable executable from \url{http://www.winscp.net}

  To transfer your files using WinSCP,

  \begin{enumerate}
  \item  Open the program
  \item  Fill in the necessary fields under \keys{Session}
  \begin{enumerate}
  \item  Press \keys{New}.
  \item  Enter ``\emph{\loginnode}'' in the \keys{Host name} field.
  \item  Put your ``\emph{vsc-account}'' in \keys{User name} field.
  \item  Select your private key in the field \keys{Private key file}.
  \item  Select \keys{SFTP} as the \keys{file} protocol.
  \item  Note that the password field remains empty.
  \end{enumerate}
  \end{enumerate}

  \includegraphics*[width=3.42in, height=3.04in, keepaspectratio=false]{img0214}

  \begin{enumerate}
  \item  By pressing on the \keys{Save} button, you can save the session under
         \keys{Stored sessions} for future access.
  \item  Finally, when clicking on \keys{Login}, you will be asked for your key passphrase.
  \end{enumerate}

  \includegraphics*[width=3.14in, height=2.47in, keepaspectratio=false]{img0215}

  The first time you make the connection, you will be asked to ``Continue
  connecting and add host key to the cache''; select \keys{Yes}.

  \includegraphics*[width=5.74in, height=2.81in, keepaspectratio=false]{img0216}

  Now, try out whether you can transfer an arbitrary file from your local
  machine to the HPC and back.

\fi

\ifmacORlinux
  \subsection{Using scp}

  \strong{Secure copy} or \strong{SCP} is a tool (command) for securely
  transferring files between a local host (= your computer) and a remote host
  (the \hpc). It is based on the Secure Shell (SSH) protocol.  The \strong{scp}
  command is the equivalent of the \strong{cp}  (i.e., \strong{c}o\strong{p}y)
  command, but can copy files to or from remote machines.

  Open a additional Terminal window and check that you're working on your local
  machine.

  \begin{prompt}
  %\shellcmd{hostname}%
  <local-machine-name>
  \end{prompt}

  If you're still using the terminal that is connected to the \hpc, close the
  connection by typing ``exit'' in the terminal window. Alternatively, open a new
  terminal window using the shortcut $<$command$>$$<$N$>$.

  For example, we will copy the (local) file ``\emph{localfile.txt}'' to your
  home directory on the \hpc cluster. We first generate a small dummy
  ``\emph{localfile.txt}'', which contains the word ``Hello''.  Use your own
  $<$vsc-account$>$, which is something like ``\emph{\userid}''.

  \begin{prompt}
  %\shellcmd{echo "Hello" $>$ localfile.txt}%
  %\shellcmd{ls -l}%
  %\dots%
  -rw-r--r-- 1 gborstlap  staff   6 Sep 18 09:37 localfile.txt
  %\shellcmd{scp localfile.txt $<$%\userid%$>$@\loginnode:}%
  localfile.txt    100%\%%   6     0.0KB/s   00:00
  \end{prompt}

  Connect to the \hpc via another terminal, print the working directory (to make
  sure you're in the home-directory) and check whether the file has arrived:

  \begin{prompt}
  %\shellcmd{pwd}%
  %\homedir%
  %\shellcmd{ls -l}%
  total 1536
  drwxrwxr-x  2 %\userid% 131072 Sep 11 16:24 bin/
  drwxrwxr-x  2 %\userid% 131072 Sep 17 11:47 docs/
  drwxrwxr-x 10 %\userid% 131072 Sep 17 11:48 examples/
  -rw-r--r--  1 %\userid%      6 Sep 18 09:44 localfile.txt
  %\shellcmd{cat localfile.txt}%
  Hello
  \end{prompt}

  Likewise, to copy the remote file ``\jobname.pdf'' from your ``docs''
  sub-directory on the cluster to your local computer, try:

  On the Terminal on the \hpc, enter:

  \begin{prompt}
  %\captureshellcmd{cd ~/docs}%
  %\homedir%/docs
  %\captureshellcmd{ls -l}%
  total 1536
  -rw-r--r-- 1 %\userid% Sep 11 09:53 %\jobname%.pdf
  \end{prompt}

  On the Terminal on your own local computer, enter:

  \begin{prompt}
  %\shellcmd{scp \userid{}@\loginnode:./docs/\jobname.pdf .}%
  %\jobname.pdf% 100%\%%  725KB 724.6KB/s   00:01
  %\shellcmd{ls -l}%
  total  899
  -rw-r--r--   1 gborstlap  staff     413 Sep 10 10:29 id_rsa.pub
  -rw-r--r--   1 gborstlap  staff  741995 Sep 18 09:53 %\jobname%.pdf
  -rw-r--r--   1 gborstlap  staff       6 Sep 18 09:37 localfile.txt
  \end{prompt}

  \subsection{Using sftp}

  The \strong{SSH File Transfer Protocol} (also \strong{Secure File Transfer
  Protocol}, or \strong{SFTP}) is a network protocol that provides file access,
  file transfer and file management functionalities over any reliable data
  stream. It was designed as an extension of the Secure Shell protocol (SSH)
  version 2.0. This protocol assumes that it is run over a secure channel, such
  as SSH, that the server has already authenticated the client, and that the
  identity of the client user is available to the protocol.

  The sftp is an equivalent of the ftp command, with the difference that it uses
  the secure ssh protocol to connect to the clusters.

  One easy way of starting a sftp session is
  \begin{prompt}
  %\shellcmd{sftp $<$\userid$>$@$<$\loginnode$>$}%
  \end{prompt}

  Typical and popular commands inside an sftp session are:

  \begin{tabular}{|p{0.3\textwidth}|p{0.6\textwidth}|} \hline
  \strong{cd \tilde/examples/fibo} & Move to the examples/fibo subdirectory on the \hpc (i.e., the remote machine)\\  \hline
  \strong{ls}                      & Get a list of the files in the current directory on the \hpc. \\ \hline
  \strong{get fibo.py}             & Copy the file ``fibo.py'' from the \hpc \\ \hline
  \strong{get tutorial/HPC.pdf}    & Copy the file ``HPC.pdf'' from the \hpc, which is in the ``tutorial'' subdirectory. \\ \hline
  \strong{lcd test}                & Move to the ``test'' subdirectory on your local machine. \\ \hline
  \strong{lcd ..}                  & Move up one level in the local directory. \\ \hline
  \strong{lls}                     & Get local directory listing \\ \hline
  \strong{put test.py}             & Copy the local file test.py to the \hpc. \\ \hline
  \strong{put test1.py test2.py}  & Copy the local file test1.py to the \hpc and rename it to test2.py. \\ \hline
  \strong{bye}                     & Quit the sftp session \\ \hline
  \strong{mget *.cc}               & Copy all the remote files with extension ``.cc'' to the local directory.  \\ \hline
  \strong{mput *.h}                & Copy all he local files with extension ``.h'' to the \hpc. \\ \hline
  \end{tabular}

  \subsection{Using FileZilla}

  If you orefer a GUI to transfer files back and forth to the \hpc, we can
  suggest to use FileZilla. FileZilla is a fast and free FTP and SFTP client,
  which is widely used.

  Download and install FileZilla client at:

  \url{https://filezilla-project.org/download.php}

  \begin{tip}
  Some users might get the notification that Filezilla.app cannot be opened
  because it is from an unidentified developer. Check out the Mac Gatekeeper at
  \url{http://support.apple.com/kb/HT5290}
  \end{tip}

  Start FileZilla and login to the \hpc with the following details:

  \begin{enumerate}
  \item  Host: sftp://\loginnode
  \item  Username:  $<$your vsc-username$>$ (e.g. \userid)
  \end{enumerate}

  \includegraphics*[width=4.75in, height=4.19in, keepaspectratio=false]{img0300}
\fi

\section{Modules}

Software installation and maintenance on a \hpc cluster such as the VSC
clusters poses a number of challenges not encountered on a workstation or a
departmental cluster. We therefore need a system on the \hpc, which is able
to easily activate or de-activate the software packages that you require for
your program execution.

\subsection{Environment Variables}

The program environment on the \hpc is controlled by pre-defined settings,
which are stored in environment (or shell) variables.

You can use shell variables to store data, set configuration options and
customize the environment on the \hpc. The default shell under Scientific
Linux on the \hpc is Bash (Bourne Again Shell) and can be used for the
following purposes:

\begin{enumerate}
\item  Configure look and feel of the shell.
\item  Setup terminal settings depending on which terminal you're using.
\item  Set the search path for running executables.
\item  Set environment variables as needed by programs.
\item  Set convenient abbreviations for heavily used values.
\item  Run commands that you want to run whenever you log in or log out.
\item  Setup aliases and/or shell function to automate tasks to save typing and time.
\item  Changing the bash prompt.
\item  Setting shell options.
\end{enumerate}

The environment variables are typically set at login by a script, whenever you
connect to the \hpc. These pre-defined variables usually impact the run time
behavior of the programs that we want to run.

All the software packages that are installed on the \hpc cluster require
different settings. These packages include compilers, interpreters,
mathematical software such as MATLAB and SAS, as well as other applications and
libraries.

In order to administer the active software and their environment variables, a
\strong{\emph{``module''}} package has been developed, which:

\begin{enumerate}
\item  Activates or de-activates \underbar{software packages} and their dependencies.
\item  Allows setting and unsetting of \underbar{environment variables}, including adding and deleting entries from database-type environment variables.
\item  Does this in a \underbar{shell-independent} fashion (necessary information is stored in the accompanying module configuration file).
\item  Takes care of \underbar{versioning aspects:} For many libraries, multiple versions are installed and maintained. The module system also takes care of the versioning of software packages in case multiple versions are installed. For instance, it does not allow multiple versions to be loaded at same time.
\item  Takes care of \underbar{dependencies:} Another issue arises when one considers library versions and the dependencies they create. Some software requires an older version of a particular library to run correctly (or at all). Hence a variety of version numbers is available for important libraries.
\end{enumerate}

This is all managed with the ``\emph{module}'' command, which is explained in the next sections.

\subsection{Available modules}

A large number of software packages are installed on the \hpc clusters. A
list of all currently available software can be obtained by typing:

\begin{prompt}
%\shellcmd{module av}%
\end{prompt}
or
\begin{prompt}
%\shellcmd{module available}%
\end{prompt}

This will give some output such as:

\inputsite{available-modules}

This gives a full list of software packages that can be loaded. Note that
modules starting with a capital letter are listed first.

\subsection{Activating and de-activating modules}

A module is loaded using the following command:

\begin{prompt}
%\shellcmd{module load MATLAB}%
\end{prompt}

This will load the most recent version of MATLAB.

For some packages, e.g., OpenMPI, multiple versions are installed; the load
command will automatically choose the most recent version (i.e., the
lexicographically last after the ``/'') or the default version (as set by the
system administrators). However, the user can (and probably should, to avoid
surprises when never versions are installed) specify a particular version,
e.g.,

\begin{prompt}
%\shellcmd{module load Python/2.7.6-intel-2014b}%
\end{prompt}

Obviously, the user needs to keep track of the modules that are currently
loaded. If he executed the two load commands stated above, he will get the
following:

\begin{prompt}
%\shellcmd{module list}%
Currently Loaded Modulefiles:
  1) cluster/delcatty(default)              8) intel/2014b
  2) MATLAB/2013b                           9) bzip2/1.0.6-intel-2014b
  3) GCC/4.8.3                             10) zlib/1.2.7-intel-2014b
  4) icc/2013.5.192-GCC-4.8.3              11) ncurses/5.9-intel-2014b
  5) ifort/2013.5.192-GCC-4.8.3            12) libreadline/6.2-intel-2014b
  6) impi/4.1.3.049-GCC-4.8.3              13) Python/2.7.6-intel-2014b
  7) imkl/11.1.2.144-2013.5.192-GCC-4.8.3
\end{prompt}

It is important to note at this point that other modules (e.g., intel/2014a)
are also listed, although the user did not explicitly load them. This is
because ``Python/2.7.6-intel-2014a'' depends on it (as indicated in its name),
and the system administrator specified that the ``intel/2014a'' module should
be loaded whenever the Python module is loaded. There are advantages and
disadvantages to this, so be aware of automatically loaded modules whenever
things go wrong: they may have something to do with it!

To unload a module, one can use the ``module unload'' command. It works
consistently with the load command, and reverses the latter's effect. However,
the dependencies of the package are NOT automatically unloaded; the user shall
unload the packages one by one. One can however unload automatically loaded
modules manually, to debug some problem. When the ``Python'' module is unloaded,
only the following modules remain:

\begin{prompt}
%\shellcmd{module unload Python}%
%\shellcmd{module list}%
  1) cluster/delcatty(default)              7) imkl/11.1.2.144-2013.5.192-GCC-4.8.3
  2) MATLAB/2013b                           8) intel/2014b
  3) GCC/4.8.3                              9) bzip2/1.0.6-intel-2014b
  4) icc/2013.5.192-GCC-4.8.3              10) zlib/1.2.7-intel-2014b
  5) ifort/2013.5.192-GCC-4.8.3            11) ncurses/5.9-intel-2014b
  6) impi/4.1.3.049-GCC-4.8.3              12) libreadline/6.2-intel-2014b
\end{prompt}

Notice that the version was not specified: the module system is sufficiently
clever to figure out what the user intends. However, checking the list of
currently loaded modules is always a good idea, just to make sure \ldots

In order to unload all modules at once, and hence be sure to start in a clean
state, you can use:

\begin{prompt}
%\shellcmd{module purge}%
\end{prompt}

%TODO: really? it isn't in gent, we first load a module that sets modulepath
% so module purge breaks further loading of modules
%It is a good habit to use this command in job-scripts, prior to loading the
%modules specifically needed by applications in that job description. This
%ensures that no version conflicts occur if the user loads module using his
%'.bashrc' file.

Modules need not be loaded one by one; the two ``load'' commands can be
combined as follows:

\begin{prompt}
%\shellcmd{module load MATLAB Python/2.7.3-ictce-4.0.1}%
\end{prompt}

This will load the two modules as well as their dependencies.

\ifgent
Finally, to switch between clusters you can swap the ``cluster'' modules.
These are special modules that change what modules are available for you,
and what cluster your jobs will be queued in.
By default you are working on \hpcname. To switch to e.g. raichu you need
to redefine the environment so you get access to all modules installed on
the raichu cluster, and to be able to submit jobs to the raichu scheduler
so your jobs will start on raichu instead of the default \hpcname cluster.

The raichu modules do not work directly on the login nodes, because the
login nodes do not have the same architecture as the raichu cluster, they
have the same architecture as the \hpcname cluster however, so this is why
by default software works on the login nodes.

\begin{prompt}
%\shellcmd{module swap cluster/raichu}%
\end{prompt}

\fi

\subsection{Explicit version numbers}

As a rule, once a module has been installed on the cluster, the executables or
libraries it comprises are never modified. This policy ensures that the user's
programs will run consistently, at least if the user specifies a specific
version. Failing to specify a version may result in unexpected behavior.

Consider the following example: the user decides to use the GSL library for
numerical computations, and at that point in time, just a single version 1.12,
compiled with Intel is installed on the cluster. The user loads the library
using:

\begin{prompt}
%\shellcmd{module load GSL}%
\end{prompt}
rather than
\begin{prompt}
%\shellcmd{module load GSL/1.12}%
\end{prompt}

Everything works fine, up to the point where a new version of GSL is installed,
1.13 compiled for gcc. From then on, the user's load command will load the
latter version, rather than the one he intended, which may lead to unexpected
problems.

Lets now generate a version conflict with the ``ABAQUS'' module, and see what
is happening.

\begin{prompt}
%\shellcmd{module av 2$>$\&1 \textbar grep ABAQUS}%
BAQUS/6.12.1-linux-x86_64
ABAQUS/6.13.5-linux-x86_64
ABAQUS/6.14.1-linux-x86_64
%\shellcmd{module load ABAQUS/6.12.1-linux-x86_64}%
%\shellcmd{module load ABAQUS/6.13.5-linux-x86_64}%
ABAQUS/6.13.5-linux-x86_64(12):ERROR:150: Module 'ABAQUS/6.13.5-linux-x86_64' conflicts with the currently loaded module(s) 'ABAQUS/6.12.1-linux-x86_64'
ABAQUS/6.13.5-linux-x86_64(12):ERROR:102: Tcl command execution failed: conflict ABAQUS
%\shellcmd{module swap scripts/2.6.0}%
\end{prompt}

Note: A ``module swap'' command combines the appropriate ``module unload''
and ``module load'' commands.

\subsection{Get detailed info}

In order to know more about a certain package, and to know what environment
variables will be changed by a certain module, try:

% TODO: this probably needs to be site-specific, or not shown as it seems a bit advanced and out of place
\begin{prompt}
%\shellcmd{module show ABAQUS}%
-------------------------------------------------------------------
/apps/gent/SL6/sandybridge/modules/all/ABAQUS/6.14.1-linux-x86_64:

module-whatis    Description: Finite Element Analysis software for modeling, visualization and best-in-class implicit and explicit dynamics FEA. - Homepage: http://www.simulia.com/products/abaqus_fea.html
conflict     ABAQUS
prepend-path PATH /apps/gent/SL6/sandybridge/software/ABAQUS/6.14.1-linux-x86_64/Commands
setenv       EBROOTABAQUS /apps/gent/SL6/sandybridge/software/ABAQUS/6.14.1-linux-x86_64
setenv       EBVERSIONABAQUS 6.14.1-linux-x86_64
setenv       EBDEVELABAQUS /apps/gent/SL6/sandybridge/software/ABAQUS/6.14.1-linux-x86_64/easybuildlog/ABAQUS-6.14.1-linux-x86_64-easybuild-devel
prepend-path PATH /apps/gent/SL6/sandybridge/software/ABAQUS/6.14.1-linux-x86_64/
-------------------------------------------------------------------
\end{prompt}

To get a list of all possible commands, type:

\begin{prompt}
%\shellcmd{module help}%
\end{prompt}
Or to get more information about one specific module package:

\begin{prompt}
%\shellcmd{module help ABAQUS}%
----------- Module Specific Help for 'ABAQUS/6.14.1-linux-x86_64' ---------------------------

   Finite Element Analysis software for modeling, visualization and best-in-class implicit and explicit dynamics FEA. - Homepage: http://www.simulia.com/products/abaqus_fea.html
\end{prompt}
