\chapter{Troubleshooting}
\label{ch:troubleshooting}



\section{Walltime issues}
If you get from your job output an error message similar to this:

\begin{prompt}
 =>> PBS: job killed: walltime %\emph{<value in seconds>}% exceeded limit %\emph{<value in seconds>}%
\end{prompt}

This occurs when your job did not complete within the requested walltime.
See section~\ref{sec:specifying-walltime-requirements} for more information about how to request the walltime.
It is recommended to use \emph{checkpointing} if the job requires \strong{72 hours} of walltime or more to be executed.
% FIXME: Refer to Checkpointing section.



\section{Out of quota issues}

Sometimes a job hangs at some point or it stops writing in the disk. These errors are usually
related to the quota usage. You may have reached your quota limit at some storage endpoint.
You should move (or remove) the data to a different storage endpoint (or request more quota) to be able to write to the disk and then resubmit the jobs.
\ifgent
Another option is to request extra quota for your VO to the VO moderator/s.
See section~\ref{subsec:predefined-user-directories} and section~\ref{subsec:predfined-quotas} for more information about
quotas and how to use the storage endpoints in an efficient way.
\fi
% FIXME: Add how to request quota section


\section{Issues connecting to login node}
\label{sec:connecting-issues}

If you're confused about the SSH public/private key pair concept, maybe the
key/lock analogy in \autoref{subsec:how-do-ssh-keys-work} can help.

If you have errors that look like

\begin{prompt}
%\userid{}%@%\loginnode%: Permission denied
\end{prompt}



If you are experiencing problems with connecting, here is a list of things to do
that should help:

\begin{enumerate}
    \item It can take up to an hour for you VSC account to become active after
        it has been \emph{approved}.
\ifmacORlinux
    \item Your SSH private key may not be in the default location (\verb|$HOME/.ssh/id_rsa|).
        There are several ways to deal with this (using one of these is sufficient):
\begin{enumerate}
            \item Use the \verb|ssh -i| (see section~\ref{sec:connect}) \emph{OR;}
            \item Use \verb|ssh-add| (see section~\ref{sec:using-ssh-agent-with-openssh}) \emph{OR;}
            \item Specify the location of the key in \verb|$HOME/.ssh/config|. You will
                need to replace the VSC login id in the \verb|User| field with your own:

            \begin{prompt}
Host %\hpcname%
    Hostname %\loginnode%
    IdentityFile %\emph{/path/to/private/key}%
    User %\emph{\userid}%\end{prompt}

    Now you can just connect with \texttt{ssh \hpcname}.
\end{enumerate}
\fi
        \item Please double/triple check your VSC login ID. It should look
            something like \emph{\userid}: the letters \verb|vsc|, followed
            by exactly 5 digits. Make sure it's the same one as the one on
            \url{https://account.vscentrum.be/}.
        \item You previously connected to the \hpc from another machine, but now
            have another machine? Please follow the procedure for adding additional
            keys in section~\ref{sec:adding-multiple-keys}. You may need to wait
            for 15-20 minutes until the SSH public key(s) you added become active.
        \item \ifwindows Make sure you're using the private key (not the public key) when trying to connect:
            If you followed the manual, the private key filename should end in
            \verb|.ppk| (not in \verb|.pub|).
            \else
            When using an SSH key in a non-default location, make sure you supply
            the path of the private key (and not the path of the public key)
            to \verb|ssh|. \verb|id_rsa.pub| is the usual filename of the public
            key, \verb|id_rsa| is the usual filename of the private key.
            (See also section~\ref{sec:connect})
            \fi
        \item If you have multiple private keys on your machine, please make sure
            you're using the one that corresponds to (one of) the public key(s) you
            added on \url{https://account.vscentrum.be/}.
        \item Please do not use someone else's private keys. You must never
            share your private key, they're called \emph{private} for a good reason.
\end{enumerate}

If you've tried all applicable items above and it doesn't solve your problem,
please contact \hpcinfo and include the following information:

\ifwindows
Please create a log file of your SSH session by following the steps
in \href{https://my.kualo.com/knowledgebase/?kbcat=0&article=888}{this article}
and include it in the email.
\else
Please add \verb|-vvv| as a flag to \verb|ssh| like:

\begin{prompt}
%\shellcmd{ssh -vvv \userid{}@\loginnode}%
\end{prompt}

and include the output of that command in the message.
\fi

\section{Warning message when first connecting to new host}
\label{sec:warning-message-new-host}

\ifmacORlinux
\begin{prompt}
%\shellcmd{ssh \userid{}@\loginnode{}}%
The authenticity of host %\loginnode% (<IP-adress>)
can't be established.
%\underline{<algorithm> key fingerprint is <hash>}%
Are you sure you want to continue connecting (yes/no)?
\end{prompt}

Now you can check the authenticity by checking if the line that is at the place
of the underlined piece of text matches one of the following lines:
\begin{prompt}
%\opensshFirstConnect%
\end{prompt}

If it does, type  \strong{\emph{yes}}. If it doesn't, please contact support: \hpcinfo.
\else
\firsttimeconnection
\fi
